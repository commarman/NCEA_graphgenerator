{% extends "layout.html" %}
{% block content %}
    <div class="info-box">
        <h1>Import Data</h1>
        <p class="info-text">Before generating graphs, you need to import NZQA data.</p>
        <p class="info-text list-header">Data must be:</p>
        <ul class="info-list">
            <li>A csv file (comma seperated values)</li>
            <li>Contain NCEA data</li>
        </ul>
        <b>Please note: Uploading data can take up to 30 seconds.</b>
    <div class="centre-form">
        <form action="/read-data" method="post" enctype="multipart/form-data" class="centre-form" onsubmit="loadBar()">
            <label for="csvfile" class="form-button">Select CSV file</label>
            {{form.nzqa(id="csvfile", class="hidden", accept=".csv", onchange="displayFilename(this)")}}
            <p id="filename-display"></p>
            <div>
                <label for="Password">Enter Password: </label>
                {{form.password(class="password-field")}}
            </div>
            <label for="submit-button" class="form-button" id="submit-label" style="visibility:hidden;">Upload</label>
            {{form.submit(class="hidden", id="submit-button", onclick="loadBar()")}}
            {{form.csrf_token}}
        </form>
    </div>
    <img id="loading-bar" src="/static/icons/LoadingBar.gif" style="visibility: hidden;">
    </div>
    {% with messages = get_flashed_messages() %}
        {% if messages|length > 0 %}
            <dialog open class="flash-dialog">
                {% for message in messages %}
                    <p>{{message}}</p>
                {% endfor %}
                <button onclick="this.parentElement.close()">Close</button>
            </dialog>
        {% endif %}
    {% endwith %}

    {% block javascript %}
    <script>
        function displayFilename(fileInput) {
            /* Display the filename using the 'filename-display element. */
            var file = fileInput.value;
            // Get just the file name, not the full path.
            var filename = file.split("\\");
            document.getElementById("filename-display").innerHTML = filename[filename.length - 1];
            document.getElementById("submit-label").style.visibility = "visible"
        }

        function loadBar() {
            /* Display a loading bar. */
            document.getElementById("loading-bar").style.visibility = "visible";
        }

    </script>
{% endblock %}
{% endblock %}