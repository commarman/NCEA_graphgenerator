{% extends "layout.html" %}
{% block content %}
    <div class="info-box">
        <h1>Graph Comparison</h1>
        <p class="info-text">To compare data, first import data from NZQA</p>
        <div class="centred-content">
            <a class="form-button" href="/submit-nzqa">Import</a>
        </div>
        {% if graph %}
        <div class="centred-content">
            <div class="chart-container">
                <canvas id="NCEAgraph"></canvas>
            </div>
        </div>
        {% endif %}
        <p class="info-text">Select filters:</p>
        <div class="filter-form">
            <form action="/retrieve-graph-data" method="post">
                <div class="form-content">
                    {{form.subject(class="filter-field")}}
                    {{form.level(class="filter-field")}}
                    {{form.assess_type(class="filter-field")}}
                    {{form.ethnicity(class="filter-field")}}
                    {{form.submit()}}
                    {{form.csrf_token}}
                </div>
            </form>
        </div>
    </div>
    {% with messages = get_flashed_messages() %}
        {% if messages|length > 0 %}
            <dialog open class="flash-dialog">
                {% for message in messages %}
                    <p>{{message}}</p>
                {% endfor %}
                <button onclick="this.parentElement.close()">Close</button>
            </dialog>
        {% endif %}
    {% endwith %}
    {% if graph %}
    {% block javascript %}
        <script>
            graph = JSON.parse({{info | tojson}});
            new Chart("NCEAgraph", {
                type: "bar",
                data : {
                    labels: graph["labels"],
                    datasets : [
                    {
                        label: "Excellence",
                        data: graph["excellence"],
                        backgroundColor: 'rgb(245, 197, 66)',
                    },
                    {
                        label: "Merit",
                        data: graph["merit"],
                        backgroundColor: 'rgb(66, 123, 245)',
                    },{
                        label: "Achieved",
                        data: graph["achieved"],
                        backgroundColor: 'rgb(245, 72, 66)',
                    },],
                },
            options : {
                scales: {
                    y: {
                        min: 0,
                        max: 100
                    },
                    x : {
                        stacked: true
                    }
                },
                plugins: {
                    title : {
                        display: true,
                        text: graph["title"]
                    },
                },
                legend : {
                    display: true
                }
            }
            });
        </script>
    {% endblock %}
    {% endif %}
{% endblock %}